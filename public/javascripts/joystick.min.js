app.controller("JoystickController",["$scope","GeneralSrv",function(t,o){function i(){y.fillStyle="#081628",y.fillRect(0,0,s.width,s.height),y.fillStyle="black",h(y,s.width/2,s.height/2,w,"#8e98a4")}function e(){x.fillStyle="white",x.fillRect(0,0,d.width,d.height),x.fillStyle="black",x.fillRect(d.width/2-2,d.height/2-2,4,4),h(x,d.width/2,d.height/2,.4*d.width)}function n(){i(),e(),h(y,s.width/2,s.height/2,g,"grey")}function h(t,o,i,e,n){t.beginPath(),t.arc(o,i,e,0,2*Math.PI,!1),n&&(t.fillStyle=n,t.fill()),t.stroke()}function c(t,o,i){t.beginPath(),t.moveTo(t.canvas.width/2,t.canvas.height/2),t.lineTo(o,i),t.stroke()}function p(t,o,i){return i*i>=t*t+o*o}function l(t,o,i){var e=o/t;return t=t>0?i/Math.sqrt(1+e*e):-i/Math.sqrt(1+e*e),o=o>0?i/Math.sqrt(1+1/(e*e)):-i/Math.sqrt(1+1/(e*e)),{x:t,y:o}}function a(t,o){var i=Math.atan2(Math.abs(o),Math.abs(t));return i>30*Math.PI/180&&i<60*Math.PI/180?o=t*o>0?t:-t:i<30*Math.PI/180?o=0:i>60*Math.PI/180&&(t=0),{x:t,y:o}}function f(t,o){return{x:t.x-o.width/2,y:o.height/2-t.y}}function r(t,o){return{x:t.x+o.width/2,y:o.height/2-t.y}}function u(t){o.socket.emit("updateJoystick",{x:t.x.toFixed(2),y:t.y.toFixed(2)})}t.lockJoystick=!1,t.lock8Directions=!0,t.showVector=!0,t.point={x:0,y:0};var s=document.getElementById("joystick"),y=s.getContext("2d"),d=document.getElementById("vector"),x=d.getContext("2d"),g=.3*s.width,w=.4*s.width,v=0;n(),t.mouseDown=function(o){evt=o,v=1,t.mouseMove(evt)},t.touchMove=function(o){o.preventDefault(),v=1,t.mouseMove(o)},t.mouseUp=function(){v=0,t.lockJoystick||t.resetAll()},t.mouseMove=function(o){1==v&&(i(),e(),"touchstart"==o.type||"touchmove"==o.type?(t.point.x=o.touches[0].pageX-s.offsetLeft,t.point.y=o.touches[0].pageY-s.offsetTop):(t.point.x=o.pageX-s.offsetLeft-3,t.point.y=o.pageY-s.offsetTop-3),t.point=f(t.point,s),t.lock8Directions&&(t.point=a(t.point.x,t.point.y)),p(t.point.x,t.point.y,w)||(t.point=l(t.point.x,t.point.y,w)),t.point=r(t.point,s),c(y,t.point.x,t.point.y),c(x,t.point.x*d.width/s.width,t.point.y*d.width/s.width),h(y,t.point.x,t.point.y,g,"grey"),t.point=f(t.point,s),u(t.point))},t.resetAll=function(){v=0,n(),t.point.x=0,t.point.y=0,u(t.point)}}]);