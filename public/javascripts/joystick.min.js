app.controller("JoystickController",["$scope","GeneralSrv",function(t,o){function i(){r.fillStyle="#081628",r.fillRect(0,0,s.width,s.height),r.fillStyle="black",h(r,s.width/2,s.height/2,g,"#8e98a4")}function e(){d.fillStyle="white",d.fillRect(0,0,y.width,y.height),d.fillStyle="black",d.fillRect(y.width/2-2,y.height/2-2,4,4),h(d,y.width/2,y.height/2,.4*y.width)}function n(){i(),e(),h(r,s.width/2,s.height/2,x,"grey")}function h(t,o,i,e,n){t.beginPath(),t.arc(o,i,e,0,2*Math.PI,!1),n&&(t.fillStyle=n,t.fill()),t.stroke()}function c(t,o,i){t.beginPath(),t.moveTo(t.canvas.width/2,t.canvas.height/2),t.lineTo(o,i),t.stroke()}function p(t,o,i){return i*i>=t*t+o*o}function l(t,o,i){var e=o/t;return t=t>0?i/Math.sqrt(1+e*e):-i/Math.sqrt(1+e*e),o=o>0?i/Math.sqrt(1+1/(e*e)):-i/Math.sqrt(1+1/(e*e)),{x:t,y:o}}function a(t,o){var i=Math.atan2(Math.abs(o),Math.abs(t));return i>30*Math.PI/180&&i<60*Math.PI/180?o=t*o>0?t:-t:i<30*Math.PI/180?o=0:i>60*Math.PI/180&&(t=0),{x:t,y:o}}function u(t,o){return{x:t.x-o.width/2,y:o.height/2-t.y}}function f(t,o){return{x:t.x+o.width/2,y:o.height/2-t.y}}t.lockJoystick=!1,t.lock8Directions=!1,t.showVector=!0,t.point={x:0,y:0};var s=document.getElementById("joystick"),r=s.getContext("2d"),y=document.getElementById("vector"),d=y.getContext("2d"),x=.3*s.width,g=.4*s.width,w=0;n(),mouseDown=function(t){evt=t,w=1,mouseMove(evt)},touchMove=function(t){t.preventDefault(),w=1,mouseMove(t)},mouseUp=function(){w=0,t.lockJoystick||t.resetAll()},mouseMove=function(o){1==w&&(i(),e(),"touchstart"==o.type||"touchmove"==o.type?(t.point.x=o.touches[0].pageX-s.offsetLeft,t.point.y=o.touches[0].pageY-s.offsetTop):(t.point.x=o.pageX-s.offsetLeft-3,t.point.y=o.pageY-s.offsetTop-3),t.point=u(t.point,s),t.lock8Directions&&(t.point=a(t.point.x,t.point.y)),p(t.point.x,t.point.y,g)||(t.point=l(t.point.x,t.point.y,g)),t.point=f(t.point,s),c(r,t.point.x,t.point.y),c(d,t.point.x*y.width/s.width,t.point.y*y.width/s.width),h(r,t.point.x,t.point.y,x,"grey"),t.point=u(t.point,s),t.updatePosition(t.point))},t.resetAll=function(){w=0,n(),t.point.x=0,t.point.y=0,t.updatePosition(t.point)},t.updatePosition=function(t){o.socket.emit("updatePosition",{x:t.x.toFixed(2),y:t.y.toFixed(2)})}}]);